{% extends "base.html" %}

{% block title %}Your Top Career Matches{% endblock %}

{% block content %}
<h1 class="text-center">Your Top 5 Career Matches</h1>

{% if top_jobs %}
<section class="section">
    <div class="card-row">
        {% for job, score in top_jobs %}
            <div class="career-card rank-{{ loop.index }}">
                <div class="card-rank">#{{ loop.index }}</div>
                <div class="card-title">{{ job.title }}</div>
                <div class="card-score">{{ '%.1f' % ((score / 30) * 100) }}%</div>
            </div>
        {% endfor %}
    </div>
</section>

<section class="section">
    <h2 class="text-center">Top Subgroups Breakdown</h2>
    <div class="chart-container">
        <canvas id="subgroupChart"></canvas>
    </div>
</section>

<section class="section">
    <h2 class="text-center">Attribute Profile Comparison</h2>
    <div class="chart-container">
        <canvas id="pentagonChart"></canvas>
        <button id="downloadRadar" class="button mt-2">Download Radar Chart</button>
    </div>
</section>

{% else %}
    <p>No results available. Please complete the quiz first.</p>
{% endif %}

<a href="{{ url_for('quiz') }}" class="button mt-4">Take the Quiz Again</a>

<footer style="text-align: center; margin-top: 2rem;">
    <p>&copy; CareerCompass</p>
</footer>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Pie Chart
    const subgroupCtx = document.getElementById('subgroupChart').getContext('2d');
    new Chart(subgroupCtx, {
        type: 'pie',
        data: {
            labels: {{ subgroup_scores.keys() | list | tojson }},
            datasets: [{
                label: 'Subgroup Scores',
                data: {{ subgroup_scores.values() | list | tojson }},
                backgroundColor: [
                    '#4A90E2', '#50E3C2', '#F5A623', '#D0021B', '#7B92AA',
                    '#B67DF5', '#FF69B4', '#2ECC71', '#FF8C00', '#00CED1'
                ],
                borderColor: '#fff',
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom' }
            },
            responsive: true,
            maintainAspectRatio: true
        }
    });

    // Radar Chart
    const radarCtx = document.getElementById('pentagonChart').getContext('2d');
    new Chart(radarCtx, {
        type: 'radar',
        data: {
            labels: ['Social', 'Physical', 'Leadership', 'Creativity', 'Logic'],
            datasets: [
                {
                    label: 'Your Profile',
                    data: [
                        {{ normalized_scores.social }},
                        {{ normalized_scores.physical }},
                        {{ normalized_scores.leadership }},
                        {{ normalized_scores.creativity }},
                        {{ normalized_scores.logic }}
                    ],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2
                },
                {
                    label: 'Average Profile',
                    data: [50, 50, 50, 50, 50],
                    backgroundColor: 'rgba(201, 203, 207, 0.2)',
                    borderColor: 'rgba(201, 203, 207, 1)',
                    pointBackgroundColor: 'rgba(201, 203, 207, 1)',
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                r: {
                    min: 0,
                    max: 100,
                    ticks: { stepSize: 20 },
                    pointLabels: { font: { size: 14 } }
                }
            },
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });

    // Download radar chart
    document.getElementById('downloadRadar').addEventListener('click', () => {
        const url = document.getElementById('pentagonChart').toDataURL("image/png");
        const link = document.createElement('a');
        link.href = url;
        link.download = 'attribute_profile_radar.png';
        link.click();
    });
});
</script>
{% endblock %}
