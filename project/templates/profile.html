{% extends "base.html" %}

{% block title %}Profile | CareerCompass{% endblock %}

{% block content %}
<div class="container">

    <header class="header">
        <h1>Welcome, {{ user.username }}</h1>
        <div class="nav-right">
            <a href="{{ url_for('base') }}" class="button" style="width:auto;">Home</a>
            <a href="{{ url_for('logout') }}" class="button" style="width:auto;">Logout</a>
        </div>
    </header>

    <section class="card">
        <h2>Profile Information</h2>
        <div class="centered" style="margin-bottom: 1rem;">
            <img src="{{ url_for('static', filename='images/user.profile_pic.jpg') }}" alt="Profile Picture" width="100" height="100" style="border-radius: 50%;">
        </div>
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Location:</strong> {{ user.location }}</p>
        {% if user.join_date %}
            <p><strong>Joined on:</strong> {{ user.join_date.strftime('%Y-%m-%d') }}</p>
        {% else %}
            <p><strong>Joined on:</strong> Unknown</p>
        {% endif %}
    </section>

    <section class="card">
        <h2>Your Career Interests</h2>
        <table style="width:100%; border-collapse: collapse;">
            <tr><th>Career Path</th><th>Rank</th></tr>
            <tr><td>Engineering</td><td>{{ user.engineering }}</td></tr>
            <tr><td>Tech</td><td>{{ user.tech }}</td></tr>
            <tr><td>Business</td><td>{{ user.business }}</td></tr>
            <!-- Add more paths as needed -->
        </table>
    </section>

    <section class="card">
        <h2>Update Profile</h2>
        <form action="{{ url_for('profile') }}" method="POST">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" value="{{ user.username }}" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="{{ user.email }}" required>

            <button class="button" type="submit">Update Profile</button>
        </form>
    </section>

    <section class="card">
        <h2>Your Quiz History</h2>

        {% if quiz_sessions %}
            <ul>
                {% for session in quiz_sessions %}
                    <li>
                        <strong>Quiz Date:</strong> {{ session.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
                        <ul>
                            {% for response in session.responses %}
                                <li>
                                    <strong>Question Type:</strong> {{ response.question_type }}<br>
                                    <strong>Target ID:</strong> {{ response.target_id }}<br>
                                    <strong>Score:</strong> {{ response.score }}
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No quiz history found.</p>
        {% endif %}
    </section>

    <footer style="text-align: center; margin-top: 2rem;">
        <p>&copy; CareerCompass</p>
    </footer>

</div>
{% endblock %}
