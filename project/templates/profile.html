{% extends "base.html" %}

{% block title %}Profile | CareerCompass{% endblock %}

{% block content %}
<div class="container">

    <header class="hero">
        <h1>Welcome, {{ user.username }}</h1>
        <h2>Your personalized career dashboard</h2>
        <div class="nav-right">
            <a href="{{ url_for('base') }}" class="button" style="width:auto;">Home</a>
            <a href="{{ url_for('logout') }}" class="button" style="width:auto;">Logout</a>
        </div>
    </header>

    <section class="card">
    <h2>Profile Information</h2>
    <div class="centered" style="margin-bottom: 1rem;">
        <img src="{{ url_for('static', filename='uploads/' + (user.profile_pic or 'user.profile_pic.jpg')) }}" 
             alt="Profile Picture" width="100" height="100" style="border-radius: 50%;">
    </div>
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Location:</strong> {{ user.location }}</p>
    {% if user.join_date %}
        <p><strong>Joined on:</strong> {{ user.join_date.strftime('%Y-%m-%d') }}</p>
    {% else %}
        <p><strong>Joined on:</strong> Unknown</p>
    {% endif %}
    </section>

    <section class="card">
    <h2>Update Profile</h2>
    <form action="{{ url_for('profile') }}" method="POST" enctype="multipart/form-data">
        <!-- Profile Picture -->
        <div class="centered" style="margin-bottom: 1rem;">
            <img src="{{ url_for('static', filename='uploads/' + (user.profile_pic or 'user.profile_pic.jpg')) }}" 
                 alt="Profile Picture" width="100" height="100" style="border-radius: 50%;">
        </div>
        <label for="profile_pic">Upload a new profile picture:</label>
        <input type="file" id="profile_pic" name="profile_pic" accept="image/*">

        <!-- Username -->
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" value="{{ user.username }}" required>

        <!-- Email -->
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="{{ user.email }}" required>

        <!-- Submit Button -->
        <button class="button" type="submit">Update Profile</button>
    </form>
    </section>

    <section class="card">
    <h2>
    <img src="{{ url_for('static', filename='images/two.png') }}" 
         alt="Career Icon" 
         style="width: 100px; height: 100px; margin-right: 10px;">
    Your Career Interests
    </h2>   
    {% if top_jobs %}
        <table style="width:100%; border-collapse: collapse;">
            <tr>
                <th>Career Path</th>
                <th>Score</th>
            </tr>
            {% for job, score in top_jobs %}
                <tr>
                    <td>{{ job.title }}</td>
                    <td>{{ '%.1f' % ((score / 30) * 100) }}%</td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No recent quiz results found. Take a quiz to see your top career matches!</p>
    {% endif %}
    </section>

    <section class="card">
        <h2>Your Friends
            <img src="{{ url_for('static', filename='images/friend.png') }}" 
         alt="Career Icon" 
         style="width: 100px; height: 100px; margin-right: 10px;">
        </h2>
        <ul>
        {% for friend in current_user.friends %}
        <li>{{ friend.username }}</li>
        {% endfor %}
        </ul>

        <h2>Send Friend Request</h2>
        <form action="{{ url_for('send_friend_request', to_user_id=user.id) }}" method="POST">
        <button class="button" type="submit">Send Friend Request</button>
        </form>
    <section class="card">

        <h2>Friend Requests</h2>
        <ul>
            {% for request in friend_requests %}
                <li>
                    {{ request.from_user.username }}
                    <form action="{{ url_for('accept_friend_request', request_id=request.id) }}" method="POST" style="display:inline;">
                        <button type="submit">Accept</button>
                    </form>
                    <form action="{{ url_for('decline_friend_request', request_id=request.id) }}" method="POST" style="display:inline;">
                        <button type="submit">Decline</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    <section class="card">

    <section class="card">
        <h3>Your Quiz History
            <img src="{{ url_for('static', filename='images/one.png') }}" 
         alt="Career Icon" 
         style="width: 100px; height: 100px; margin-right: 10px;">
        </h3>

        {% if quiz_sessions %}
            <ul>
                {% for session in quiz_sessions %}
                    <li>
                        <strong>Quiz Date:</strong> {{ session.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
                        <a href="{{ url_for('results', session_id=session.session_id) }}" class="button">View Results</a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No quiz history found.</p>
        {% endif %}
    </section> 

    <footer style="text-align: center; margin-top: 2rem;">
        <p>&copy; CareerCompass</p>
    </footer>

</div>
{% endblock %}
